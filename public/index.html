<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>zero-auth (local)</title>
    <style>
      :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
      body { margin: 2rem; color: #222; }
      code { background: #f3f3f3; padding: .2rem .35rem; border-radius: 4px; }
      button { padding: .4rem .7rem; border-radius: 6px; border: 1px solid #ccc; background: #fff; cursor: pointer; }
      button:hover { background: #f6f6f6; }
      .row { margin: 1rem 0; }
      .muted { color: #666; font-size: .9rem; }
    </style>
  </head>
  <body>
    <h1>zero-auth (local)</h1>
    <p>You are recognized as:</p>
    <div class="row"><code id="uid">(loadingâ€¦)</code></div>
    <div class="row">
      <button id="reset">Reset identity</button>
    </div>
    <p class="muted">Same browser profile = same identity. Clearing site data resets it.</p>

    <script>
      async function fetchMe() {
        const res = await fetch('/me', { credentials: 'same-origin' });
        if (!res.ok) throw new Error('Failed to fetch /me');
        return res.json();
      }
      async function resetId() {
        const res = await fetch('/reset', { method: 'POST', credentials: 'same-origin' });
        if (!res.ok) throw new Error('Failed to reset');
        return res.json();
      }

      (async () => {
        try {
          const { id } = await fetchMe();
          document.getElementById('uid').textContent = id;
        } catch (e) {
          document.getElementById('uid').textContent = 'Error loading ID';
          console.error(e);
        }
      })();

      document.getElementById('reset').addEventListener('click', async () => {
        try {
          await resetId();
          const { id } = await fetchMe();
          document.getElementById('uid').textContent = id;
        } catch (e) {
          alert('Failed to reset identity');
          console.error(e);
        }
      });
    </script>
  </body>
  </html>

